#define fmc_spi spi0

// ad9528_reset_b,       // 59
// ad9528_sysref_req,    // 58

&clk0_ad9528 {
	reset-gpios = <&gpio0 113 0>;
};

#include <dt-bindings/iio/frequency/ad9528.h>

/ {
	clocks {
		ad9371_clkin: clock@0 {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <12288000>;
			clock-output-names = "ad9371_ext_refclk";
		};
	};
};

&sys_spi {
	clk0_ad9528: ad9528-1@0 {
		#address-cells = <1>;
		#size-cells = <0>;
		#clock-cells = <1>;
		compatible = "ad9528";

		spi-max-frequency = <10000000>;
		//adi,spi-3wire-enable;
		reg = <0>;

		reset-gpios = <&sys_gpio_out 27 0>;

		clock-output-names = "ad9528-1_out0", "ad9528-1_out1", "ad9528-1_out2", "ad9528-1_out3", "ad9528-1_out4", "ad9528-1_out5", "ad9528-1_out6", "ad9528-1_out7", "ad9528-1_out8", "ad9528-1_out9", "ad9528-1_out10", "ad9528-1_out11", "ad9528-1_out12", "ad9528-1_out13";
		adi,vcxo-freq = <122880000>;

		adi,refa-enable;
		adi,refa-diff-rcv-enable;
		adi,refa-r-div = <1>;
		adi,osc-in-cmos-neg-inp-enable;

		/* PLL1 config */
		adi,pll1-feedback-div = <1>;/* change from 4 to 1 per RF, 2018/11/01 */
		adi,pll1-charge-pump-current-nA = <5000>;

		/* PLL2 config */
		adi,pll2-vco-div-m1 = <3>; /* use 5 for 184320000 output device clock */
		adi,pll2-n2-div = <10>; /* N / M1 */
		adi,pll2-r1-div = <1>;
		adi,pll2-charge-pump-current-nA = <805000>;

		/* SYSREF config */
		adi,sysref-src = <SYSREF_SRC_INTERNAL>;/* SYSREF Mode3: Internal */
		adi,sysref-pattern-mode = <SYSREF_PATTERN_CONTINUOUS>;
		adi,sysref-k-div = <512>;
		/* [0x0402]bit7: SYSREF request method: 1/hardware(SYSREF_REQ), 0/software(SPI-interface) */
		//adi,sysref-request-enable;
		adi,sysref-nshot-mode = <SYSREF_NSHOT_4_PULSES>;
		adi,sysref-request-trigger-mode = <SYSREF_LEVEL_HIGH>;

		adi,rpole2 = <RPOLE2_900_OHM>;
		adi,rzero = <RZERO_1850_OHM>;
		adi,cpole1 = <CPOLE1_16_PF>;

		adi,status-mon-pin0-function-select = <1>; /* PLL1 & PLL2 Locked */
		adi,status-mon-pin1-function-select = <7>; /* REFA Correct */

		ad9528_0_c6: channel@6 {
			reg = <6>;
			adi,extended-name = "DEV_CLK_N1";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_VCO>;
		};

		ad9528_0_c3: channel@3 {
			reg = <3>;
			adi,extended-name = "FMC_CLK_M1";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_VCO>;
		};

		ad9528_0_c5: channel@5 {
			reg = <5>;
			adi,extended-name = "DEV_SYSREF_N1";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_SYSREF_VCO>;
		};

		ad9528_0_c2: channel@2 {
			reg = <2>;
			adi,extended-name = "FMC_SYSREF_M1";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_SYSREF_VCO>;
		};

		ad9528_0_c0: channel@0 {
			reg = <0>;
			adi,extended-name = "DEV_SYSREF_N2";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_SYSREF_VCO>;
		};

		ad9528_0_c1: channel@1 {
			reg = <1>;
			adi,extended-name = "DEV_CLK_N2";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_VCO>;
		};

		ad9528_0_c7: channel@7 {
			reg = <7>;
			adi,extended-name = "DEV_SYSREF_N4";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_SYSREF_VCO>;
		};

		ad9528_0_c8: channel@8 {
			reg = <8>;
			adi,extended-name = "DEV_CLK_N4";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_VCO>;
		};

		ad9528_0_c12: channel@12 {
			reg = <12>;
			adi,extended-name = "DEV_SYSREF_N3";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_SYSREF_VCO>;
		};

		ad9528_0_c13: channel@13 {
			reg = <13>;
			adi,extended-name = "DEV_CLK_N3";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_VCO>;
		};

		ad9528_0_c9: channel@9 {
			reg = <9>;
			adi,extended-name = "FMC_SYSREF_M2";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_SYSREF_VCO>;
		};

		ad9528_0_c11: channel@11 {
			reg = <11>;
			adi,extended-name = "FMC_CLK_M2";
			adi,driver-mode = <DRIVER_MODE_LVDS>;
			adi,divider-phase = <0>;
			adi,channel-divider = <10>;
			adi,signal-source = <SOURCE_VCO>;
		};
	};
};
